(function(exports){var s="http://www.w3.org/2001/XMLSchema-instance";var a="urn:iso:std:iso:20022:tech:xsd:";var e="1.0";var n="UTF-8";var r="pain.008.001.02";var i=".";function t(t){i=t}var I=true;function o(t){I=!!t}var u={"pain.001.001.02":"pain.001.001.02","pain.001.003.02":"pain.001.003.02","pain.001.001.03":"CstmrCdtTrfInitn","pain.001.003.03":"CstmrCdtTrfInitn","pain.008.001.01":"pain.008.001.01","pain.008.003.01":"pain.008.003.01","pain.008.001.02":"CstmrDrctDbtInitn","pain.008.003.02":"CstmrDrctDbtInitn"};function m(t){var e=t.indexOf("pain.008")===0?1:0;return parseInt(t.substr(-2),10)+e}function d(t){this._painFormat=t||r;this._type=u[this._painFormat];this._paymentInfo=[];this._xmlVersion=e;this._xmlEncoding=n;this.grpHdr=new h(this._painFormat)}d.Types=u;d.prototype={_painFormat:null,grpHdr:null,_paymentInfo:[],_type:null,_xmlVersion:null,_xmlEncoding:null,addPaymentInfo:function(t){if(!(t instanceof c)){throw new Error("Given payment is not member of the PaymentInfo class")}if(t.id){t.id=this.grpHdr.id+i+t.id}else{t.id=this.grpHdr.id+i+this._paymentInfo.length}this._paymentInfo.push(t)},createPaymentInfo:function(){return new c(this._painFormat)},normalize:function(){var t=0;var e=0;for(var n=0,r=this._paymentInfo.length;n<r;++n){this._paymentInfo[n].normalize();t+=this._paymentInfo[n].controlSum;e+=this._paymentInfo[n].transactionCount}this.grpHdr.controlSum=t;this.grpHdr.transactionCount=e},toXML:function(){this.normalize();var t=a+this._painFormat;var e=F(t,"Document");e.xmlVersion=this._xmlVersion;e.xmlEncoding=this._xmlEncoding;var n=e.documentElement;n.setAttribute("xmlns:xsi",s);n.setAttribute("xsi:schemaLocation",a+this._painFormat+" "+this._painFormat+".xsd");var r=e.createElementNS(t,this._type);r.appendChild(this.grpHdr.toXML(e));for(var i=0,o=this._paymentInfo.length;i<o;++i){r.appendChild(this._paymentInfo[i].toXML(e))}e.documentElement.appendChild(r);return e},toString:function(){var t=this.toXML();var e='<?xml version="'+this._xmlVersion+'" encoding="'+this._xmlEncoding+'"?>';return e+R(t)}};function h(t){this._painFormat=t}h.prototype={_painFormat:null,id:"",created:"",transactionCount:0,initiatorName:"",controlSum:0,batchBooking:false,grouping:"MIXD",toXML:function(t){var e=O(t,true,true);var n=t.createElementNS(t.documentElement.namespaceURI,"GrpHdr");var r=m(this._painFormat);e(n,"MsgId",this.id);e(n,"CreDtTm",this.created.toISOString().substr(0,19));if(r===2){e(n,"BtchBookg",this.batchBooking.toString())}e(n,"NbOfTxs",this.transactionCount);e(n,"CtrlSum",this.controlSum.toFixed(2));if(r===2){e(n,"Grpg",this.grouping)}e(n,"InitgPty","Nm",this.initiatorName);return n},toString:function(){return R(this.toXML())}};var l={DirectDebit:"DD",Transfer:"TRF"};function c(t){this._painFormat=t;this.method=t.indexOf("pain.001")===0?l.Transfer:l.DirectDebit;this._payments=[]}c.PaymentInfoTypes=l;c.prototype={_painFormat:null,_payments:null,id:"",method:null,batchBooking:false,grouping:"MIXD",controlSum:0,localInstrumentation:"CORE",sequenceType:"FRST",collectionDate:null,requestedExecutionDate:null,creditorId:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",debtorId:"",debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",instructionPriority:"NORM",get transactionCount(){return this._payments.length},normalize:function(){var t=0;for(var e=0,n=this._payments.length;e<n;++e){t+=this._payments[e].amount}this.controlSum=t},addTransaction:function(t){if(!(t instanceof f)){throw new Error("Given Transaction is not member of the SepaTransaction class")}if(t.id){t.id=this.id+i+t.id}else{t.id=this.id+i+this._payments.length}this._payments.push(t)},createTransaction:function(){return new f(this._painFormat)},validate:function(){var t=this.method===l.DirectDebit?"creditor":"debtor";_(this.localInstrumentation,["CORE","COR1","B2B"],"localInstrumentation");_(this.sequenceType,["FRST","RCUR","OOFF","FNAL"],"sequenceType");if(this.method===l.DirectDebit){E(this.collectionDate,"collectionDate")}else{E(this.requestedExecutionDate,"requestedExecutionDate")}x(this[t+"Id"],t+"Id");B(this[t+"Name"],null,70,t+"Name");B(this[t+"Street"],null,70,t+"Street");B(this[t+"City"],null,70,t+"City");B(this[t+"Country"],null,2,t+"Country");N(this[t+"IBAN"],t+"IBAN");B(this[t+"BIC"],[0,8,11],t+"BIC");var e=this[t+"BIC"].length===0||this[t+"BIC"].substr(4,2)===this[t+"IBAN"].substr(0,2);S(e,"country mismatch in BIC/IBAN");B(this._payments.length,1,null,"_payments")},toXML:function(t){if(I){this.validate()}var e=O(t,true,false);var n=O(t,true,true);var r=t.createElementNS(t.documentElement.namespaceURI,"PmtInf");n(r,"PmtInfId",this.id);n(r,"PmtMtd",this.method);if(m(this._painFormat)===3){n(r,"BtchBookg",this.batchBooking.toString());n(r,"NbOfTxs",this.transactionCount);n(r,"CtrlSum",this.controlSum.toFixed(2))}var i=e(r,"PmtTpInf");n(i,"SvcLvl","Cd","SEPA");if(this.method===l.DirectDebit){n(i,"LclInstrm","Cd",this.localInstrumentation);n(i,"SeqTp",this.sequenceType);n(r,"ReqdColltnDt",this.collectionDate.toISOString().substr(0,10))}else{n(r,"ReqdExctnDt",this.requestedExecutionDate.toISOString().substr(0,10))}var o=this.method===l.DirectDebit?"creditor":"debtor";var s=this.method===l.DirectDebit?"Cdtr":"Dbtr";var a=e(r,s);n(a,"Nm",this[o+"Name"]);if(this[o+"Street"]&&this[o+"City"]&&this[o+"Country"]){var u=e(a,"PstlAdr");n(u,"Ctry",this[o+"Country"]);n(u,"AdrLine",this[o+"Street"]);n(u,"AdrLine",this[o+"City"])}n(r,s+"Acct","Id","IBAN",this[o+"IBAN"]);if(this[o+"BIC"]){n(r,s+"Agt","FinInstnId","BIC",this[o+"BIC"])}else{n(r,s+"Agt","FinInstnId","Othr","Id","NOTPROVIDED")}n(r,"ChrgBr","SLEV");if(this.method===l.DirectDebit){var d=e(r,"CdtrSchmeId","Id","PrvtId","Othr");n(d,"Id",this.creditorId);n(d,"SchmeNm","Prtry","SEPA")}for(var h=0,c=this._payments.length;h<c;++h){r.appendChild(this._payments[h].toXML(t))}return r},toString:function(){return R(this.toXML())}};var p={DirectDebit:"DrctDbtTxInf",Transfer:"CdtTrfTxInf"};function f(t){this._painFormat=t;this._type=t.indexOf("pain.001")===0?p.Transfer:p.DirectDebit}f.TransactionTypes=p;f.prototype={_type:p.DirectDebit,id:"",end2endId:"",currency:"EUR",amount:0,purposeCode:null,mandateId:"",mandateSignatureDate:null,debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",remittanceInfo:"",structuredRemittanceInfo:{typeCode:"",issuer:"",reference:""},creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",validate:function(){var t=this._type===p.Transfer?"creditor":"debtor";T(this.end2endId,"end2endId");A(this.amount,.01,999999999.99,"amount");S(this.amount==this.amount.toFixed(2),"amount has too many fractional digits");B(this.purposeCode,1,4,"purposeCode");w(this.mandateId,"mandateId");E(this.mandateSignatureDate,"mandateSignatureDate");B(this[t+"Name"],null,70,t+"Name");B(this[t+"Street"],null,70,t+"Street");B(this[t+"City"],null,70,t+"City");B(this[t+"Country"],null,2,t+"Country");N(this[t+"IBAN"],t+"IBAN");_(this[t+"BIC"].length,[0,8,11],t+"BIC");var e=this[t+"BIC"].length===0||this[t+"BIC"].substr(4,2)===this[t+"IBAN"].substr(0,2);S(e,"country mismatch in BIC/IBAN");B(this.remittanceInfo,null,140,"remittanceInfo");if(this.structuredRemittanceInfo.reference){B(this.structuredRemittanceInfo.typeCode,null,35,"typeCode");B(this.structuredRemittanceInfo.issuer,null,35,"issuer");B(this.structuredRemittanceInfo.reference,null,35,"reference")}},toXML:function(t){if(I){this.validate()}var e=this._type===p.Transfer?"creditor":"debtor";var n=this._type===p.Transfer?"Cdtr":"Dbtr";var r=O(t,true,false);var i=O(t,false,true);var o=O(t,true,true);var s=t.createElementNS(t.documentElement.namespaceURI,this._type);var a=r(s,"PmtId");o(a,"InstrId",this.id);o(a,"EndToEndId",this.end2endId);if(this._type===p.DirectDebit){o(s,"InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);var u=r(s,"DrctDbtTx","MndtRltdInf");o(u,"MndtId",this.mandateId);o(u,"DtOfSgntr",this.mandateSignatureDate.toISOString().substr(0,10));if(this.ammendment){o(u,"AmdmntInd","true");o(u,"AmdmnInfDtls",this.ammendment)}else{o(u,"AmdmntInd","false")}}else{o(s,"Amt","InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency)}if(this[e+"BIC"]){o(s,n+"Agt","FinInstnId","BIC",this[e+"BIC"])}else{o(s,n+"Agt","FinInstnId","Othr","Id","NOTPROVIDED")}var d=r(s,n);o(d,"Nm",this[e+"Name"]);if(this[e+"Street"]&&this[e+"City"]&&this[e+"Country"]){var h=r(d,"PstlAdr");o(h,"Ctry",this.debtorCountry);o(h,"AdrLine",this.debtorStreet);o(h,"AdrLine",this.debtorCity)}o(s,n+"Acct","Id","IBAN",this[e+"IBAN"]);var c=r(s,"RmtInf");if(this.structuredRemittanceInfo.reference){var m=r(c,"Strd");var l=r(m,"CdtrRefInf");var f=r(l,"Tp","CdOrPrtry");o(f,"Cd",this.structuredRemittanceInfo.typeCode);o(l,"Issr",this.structuredRemittanceInfo.issuer);o(l,"Ref",this.structuredRemittanceInfo.reference)}else{o(c,"Ustrd",this.remittanceInfo)}i(s,"Purp","Cd",this.purposeCode);return s}};function y(t){var e="";for(var n=0,r=t.length;n<r;++n){var i=t.charCodeAt(n);if(i>=65&&i<=90){e+=(i-55).toString()}else if(i>=97&&i<=122){e+=(i-87).toString()}else if(i>=48&&i<=57){e+=t[n]}}return e}function C(t){var e=0;for(var n=0,r=t.length;n<r;++n){e=(e*10+parseInt(t[n],10))%97}return e}function v(t){var e=t.substr(4)+t.substr(0,4);return C(y(e))===1}function g(t){var e=t.substr(4)+t.substr(0,2)+"00";var n=C(y(e));return t.substr(0,2)+("0"+(98-n)).substr(-2,2)+t.substr(4)}function b(t){var e=t.substr(7)+t.substr(0,4);return C(y(e))===1}function D(t){var e=t.substr(7)+t.substr(0,2)+"00";var n=C(y(e));return t.substr(0,2)+("0"+(98-n)).substr(-2,2)+t.substr(4)}function S(t,e){if(!t){throw new Error(e)}}function _(t,e,n){if(e.indexOf(t)<0){throw new Error(n+" must have any value of: "+e.join(" ")+"(found: "+t+")")}}function B(t,e,n,r){if(e!==null&&t&&t.length<e||n!==null&&t&&t.length>n){throw new Error(r+" has invalid string length, expected "+e+" < "+t+" < "+n)}}function A(t,e,n,r){if(t<e||t>n){throw new Error(r+" does not match range "+e+" < "+t+" < "+n)}}function N(t,e){if(!v(t)){throw new Error(e+' has invalid IBAN "'+t+'"')}}function x(t,e){if(!b(t)){throw new Error(e+' is invalid "'+t+'"')}}function E(t,e){if(!t||isNaN(t.getTime())){throw new Error(e+" has invalid date "+t)}}function T(t,e){if(t&&!t.match(/([A-Za-z0-9]|[+|?|/|\-|:|(|)|.|,|'| ]){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 1 (found: "+'"'+t+'")')}}function w(t,e){if(t&&!t.match(/([A-Za-z0-9]|[+|?|/|\-|:|(|)|.|,|']){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 2 (found: "+'"'+t+'")')}}function F(t,e){if(typeof document!=="undefined"&&typeof document.implementation!=="undefined"){return document.implementation.createDocument(t,e)}else{var n=require("@xmldom/xmldom").DOMImplementation;return(new n).createDocument(t,e)}}function R(t){var e;if(typeof window==="undefined"){var n=require("@xmldom/xmldom").XMLSerializer;e=new n}else{e=new window.XMLSerializer}return e.serializeToString(t)}function O(i,o,s){return function(){var t=arguments[0];var e=s&&arguments[arguments.length-1];var n=s?arguments.length-1:arguments.length;if(o||e||e===0){for(var r=1;r<n;++r){t=t.appendChild(i.createElementNS(i.documentElement.namespaceURI,arguments[r]))}if(s){t.textContent=e}return t}else{return null}}}exports.Document=d;exports.validateIBAN=v;exports.checksumIBAN=g;exports.validateCreditorID=b;exports.checksumCreditorID=D;exports.setIDSeparator=t;exports.enableValidations=o})(typeof exports==="undefined"?this.SEPA={}:exports);